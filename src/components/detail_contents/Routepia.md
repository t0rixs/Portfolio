### 制作期間
2025年4月 - (現在も開発中)

### 開発環境

[![Languages](https://skillicons.dev/icons?i=flutter,dart)](https://skillicons.dev)  

### 1. アプリ制作に至った背景
元になった愛用アプリ「マッピング」から、自分で改良したいという思いで作成を始めました。

### 2. アプリの概要
GPSで現在地を常時取得し、人生の足跡を一つの地図にまとめるアプリです。
ヒートマップ形式で足跡が表示されます。

### 3. 作った経緯
マッピングは、GPSで現在地を記録し、マス目状にそれを記録&表示するアプリです。
通信もせず、ただローカルでそれを行なっていくだけのシンプルさが逆にクセになるのですが、
このアプリが制作されたのはおよそ10年前で、いろいろ気になる点がありました。
1. 表示されたマス目の解像度が低い
2. UIが古い
3. 飛行機で記録すると美しくない

そこで、自分なりに改良を試みたものとなります。
(現在は1が実装完了、2は実装中、3は計画段階です。)

### 4. 開発にあたって

Routepiaの開発では、「既存アプリ（10年前の設計）との互換性」と「膨大な描画データの最適化」という2つの大きな壁に直面しました。

#### 【課題1】独自データ構造のリバースエンジニアリング
既存アプリのバックアップデータを解析し、自作アプリでも継続して利用できるようにする必要がありました。しかし、保存されたSQLiteデータ内の座標値は、緯度経度が直接格納されているわけではなく、一見すると無意味な数値の羅列でした。

* **検証アプローチ：** GPSの現在地を擬似的に操作するデバッグ用アプリを自作。特定の極致（北緯90°、東経180°など）を意図的に記録させ、生成されるバイナリデータとの差分を比較・検証しました。
* **解析結果：** 「南緯90°・西経180°」を基準点とし、0.0002° 刻みでインデックス化された独自グリッド座標系であることを特定しました。
    - **計算式：** 緯度 = lat * 0.0002 - 180 , 経度 = lng * 0.0002 - 90
* **成果：** 10年前の設計思想を解明したことで、過去数年分におよぶ「人生の足跡」を、1pxのズレもなく新アプリへ移行・復元することに成功しました。

#### 【課題2】描画パフォーマンスの最適化（PolygonからTileOverlayへ）
当初、各グリッドをPolygonオブジェクトとして描画していましたが、数万件のデータを読み込むとメモリ圧迫によりアプリがクラッシュする、あるいは描画が著しく遅延する課題に直面しました。

* **解決策：** Google Maps APIの **TileOverlay** を採用する方式へ抜本的に設計変更を行いました。これは地図のタイル（512px四方の画像）が要求されるたびに、該当範囲のデータのみを抽出して透過PNGとして動的にレンダリングする仕組みです。
* **実装の工夫：** メルカトル投影法のタイル座標と、解析した独自の等距グリッド座標をマッピングするロジックを自作。`floor`関数を用いた境界判定を行うことで、タイルをまたぐマス目も欠損することなく、かつ最小限の計算リソースで描画するアルゴリズムを構築しました。
* **成果：** 数千個のオブジェクトを生成する負荷を排除し、**数万件の足跡データがあっても滑らかなスクロールとズームが可能な操作性**を実現しました。



---

### 今後の展望
モダンなUIの設計&実装を進めています。